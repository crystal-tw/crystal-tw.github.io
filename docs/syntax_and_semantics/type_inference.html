<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Type inference | Crystal 程式語言</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="../syntax_and_semantics/overloading.html" />
    
    
    <link rel="prev" href="../syntax_and_semantics/methods_and_instance_variables.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="4.8.3.3" data-basepath=".." data-revision="Thu Jun 16 2016 06:17:13 GMT+0000 (UTC)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        簡介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="installation/index.html">
            
                
                    <a href="../installation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        安裝
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="installation/on_debian_and_ubuntu.html">
            
                
                    <a href="../installation/on_debian_and_ubuntu.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        在 Debian / Ubuntu 環境下安裝
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="installation/on_redhat_and_centos.html">
            
                
                    <a href="../installation/on_redhat_and_centos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        在 RedHat / CentOS 環境下安裝
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="installation/on_arch_linux.html">
            
                
                    <a href="../installation/on_arch_linux.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        在 Arch Linux 環境下安裝
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="installation/on_mac_osx_using_homebrew.html">
            
                
                    <a href="../installation/on_mac_osx_using_homebrew.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        在 Mac OSX 環境下使用 Homebrew 安裝
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="installation/from_a_targz.html">
            
                
                    <a href="../installation/from_a_targz.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        使用 .tar.gz 檔案安裝
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="installation/from_source_repository.html">
            
                
                    <a href="../installation/from_source_repository.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        從原始碼安裝
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="using_the_compiler/index.html">
            
                
                    <a href="../using_the_compiler/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        使用編譯器
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="overview/index.html">
            
                
                    <a href="../overview/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        概要
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="overview/hello_world.html">
            
                
                    <a href="../overview/hello_world.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Hello World!
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="overview/http_server.html">
            
                
                    <a href="../overview/http_server.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        HTTP伺服器
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="syntax_and_semantics/index.html">
            
                
                    <a href="../syntax_and_semantics/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        語法及語意
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="syntax_and_semantics/comments.html">
            
                
                    <a href="../syntax_and_semantics/comments.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        註解
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="syntax_and_semantics/literals.html">
            
                
                    <a href="../syntax_and_semantics/literals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        常值 (Literals)
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="syntax_and_semantics/literals/nil.html">
            
                
                    <a href="../syntax_and_semantics/literals/nil.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.1.</b>
                        
                        空值 (Nil)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="syntax_and_semantics/literals/bool.html">
            
                
                    <a href="../syntax_and_semantics/literals/bool.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.2.</b>
                        
                        布林值 (Bool)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="syntax_and_semantics/literals/integers.html">
            
                
                    <a href="../syntax_and_semantics/literals/integers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.3.</b>
                        
                        整數 (Integers)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="syntax_and_semantics/literals/floats.html">
            
                
                    <a href="../syntax_and_semantics/literals/floats.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.4.</b>
                        
                        浮點數 (Floats)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="syntax_and_semantics/literals/char.html">
            
                
                    <a href="../syntax_and_semantics/literals/char.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.5.</b>
                        
                        字元 (Char)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="syntax_and_semantics/literals/string.html">
            
                
                    <a href="../syntax_and_semantics/literals/string.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.6.</b>
                        
                        字串 (String)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="syntax_and_semantics/literals/symbol.html">
            
                
                    <a href="../syntax_and_semantics/literals/symbol.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.7.</b>
                        
                        符號 (Symbol)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.8" data-path="syntax_and_semantics/literals/array.html">
            
                
                    <a href="../syntax_and_semantics/literals/array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.8.</b>
                        
                        陣列 (Array)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.9" data-path="syntax_and_semantics/literals/hash.html">
            
                
                    <a href="../syntax_and_semantics/literals/hash.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.9.</b>
                        
                        雜湊 (Hash)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.10" data-path="syntax_and_semantics/literals/range.html">
            
                
                    <a href="../syntax_and_semantics/literals/range.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.10.</b>
                        
                        範圍 (Range)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.11" data-path="syntax_and_semantics/literals/regex.html">
            
                
                    <a href="../syntax_and_semantics/literals/regex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.11.</b>
                        
                        正規表示式 (Regex)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.12" data-path="syntax_and_semantics/literals/tuple.html">
            
                
                    <a href="../syntax_and_semantics/literals/tuple.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.12.</b>
                        
                        序組 (Tuple)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.13" data-path="syntax_and_semantics/literals/named_tuple.html">
            
                
                    <a href="../syntax_and_semantics/literals/named_tuple.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.13.</b>
                        
                        命名序組 (NamedTuple)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.14" data-path="syntax_and_semantics/literals/proc.html">
            
                
                    <a href="../syntax_and_semantics/literals/proc.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.14.</b>
                        
                        程序 (Proc)
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="syntax_and_semantics/local_variables.html">
            
                
                    <a href="../syntax_and_semantics/local_variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Local variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="syntax_and_semantics/global_variables.html">
            
                
                    <a href="../syntax_and_semantics/global_variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Global variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="syntax_and_semantics/assignment.html">
            
                
                    <a href="../syntax_and_semantics/assignment.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Assignment
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="syntax_and_semantics/multiple_assignment.html">
            
                
                    <a href="../syntax_and_semantics/multiple_assignment.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.1.</b>
                        
                        Multiple assignment
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="syntax_and_semantics/union_types.html">
            
                
                    <a href="../syntax_and_semantics/union_types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Union types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="syntax_and_semantics/control_expressions.html">
            
                
                    <a href="../syntax_and_semantics/control_expressions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        Control expressions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="syntax_and_semantics/truthy_and_falsey_values.html">
            
                
                    <a href="../syntax_and_semantics/truthy_and_falsey_values.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.1.</b>
                        
                        Truthy and falsey values
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2" data-path="syntax_and_semantics/if.html">
            
                
                    <a href="../syntax_and_semantics/if.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.</b>
                        
                        if
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.2.1" data-path="syntax_and_semantics/as_a_suffix.html">
            
                
                    <a href="../syntax_and_semantics/as_a_suffix.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.1.</b>
                        
                        作為後綴
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.2" data-path="syntax_and_semantics/as_an_expression.html">
            
                
                    <a href="../syntax_and_semantics/as_an_expression.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.2.</b>
                        
                        作為表達式
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.3" data-path="syntax_and_semantics/ternary_if.html">
            
                
                    <a href="../syntax_and_semantics/ternary_if.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.3.</b>
                        
                        Ternary if
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.4" data-path="syntax_and_semantics/if_var.html">
            
                
                    <a href="../syntax_and_semantics/if_var.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.4.</b>
                        
                        if var
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.5" data-path="syntax_and_semantics/if_varis_a.html">
            
                
                    <a href="../syntax_and_semantics/if_varis_a.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.5.</b>
                        
                        if var.is_a?(...)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.6" data-path="syntax_and_semantics/if_varresponds_to.html">
            
                
                    <a href="../syntax_and_semantics/if_varresponds_to.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.6.</b>
                        
                        if var.responds_to?(...)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.7" data-path="syntax_and_semantics/if_var_nil.html">
            
                
                    <a href="../syntax_and_semantics/if_var_nil.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.7.</b>
                        
                        if var.nil?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.2.8" data-path="syntax_and_semantics/not.html">
            
                
                    <a href="../syntax_and_semantics/not.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.2.8.</b>
                        
                        if !
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7.3" data-path="syntax_and_semantics/unless.html">
            
                
                    <a href="../syntax_and_semantics/unless.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.3.</b>
                        
                        unless
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.4" data-path="syntax_and_semantics/case.html">
            
                
                    <a href="../syntax_and_semantics/case.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.4.</b>
                        
                        case
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.5" data-path="syntax_and_semantics/while.html">
            
                
                    <a href="../syntax_and_semantics/while.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.5.</b>
                        
                        while
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.5.1" data-path="syntax_and_semantics/break.html">
            
                
                    <a href="../syntax_and_semantics/break.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.5.1.</b>
                        
                        break
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.5.2" data-path="syntax_and_semantics/next.html">
            
                
                    <a href="../syntax_and_semantics/next.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.5.2.</b>
                        
                        next
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7.6" data-path="syntax_and_semantics/until.html">
            
                
                    <a href="../syntax_and_semantics/until.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.6.</b>
                        
                        until
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.7" data-path="syntax_and_semantics/and.html">
            
                
                    <a href="../syntax_and_semantics/and.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.7.</b>
                        
                        &amp;&amp;
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7.8" data-path="syntax_and_semantics/or.html">
            
                
                    <a href="../syntax_and_semantics/or.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.8.</b>
                        
                        ||
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="syntax_and_semantics/types_and_methods.html">
            
                
                    <a href="../syntax_and_semantics/types_and_methods.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        Types and methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.1" data-path="syntax_and_semantics/everything_is_an_object.html">
            
                
                    <a href="../syntax_and_semantics/everything_is_an_object.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.1.</b>
                        
                        Everything is an object
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.2" data-path="syntax_and_semantics/the_program.html">
            
                
                    <a href="../syntax_and_semantics/the_program.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.2.</b>
                        
                        The Program
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3" data-path="syntax_and_semantics/classes_and_methods.html">
            
                
                    <a href="../syntax_and_semantics/classes_and_methods.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.</b>
                        
                        Classes and methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.3.1" data-path="syntax_and_semantics/new,_initialize_and_allocate.html">
            
                
                    <a href="../syntax_and_semantics/new,_initialize_and_allocate.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.1.</b>
                        
                        new, initialize and allocate
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.2" data-path="syntax_and_semantics/methods_and_instance_variables.html">
            
                
                    <a href="../syntax_and_semantics/methods_and_instance_variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.2.</b>
                        
                        Methods and instance variables
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="4.8.3.3" data-path="syntax_and_semantics/type_inference.html">
            
                
                    <a href="../syntax_and_semantics/type_inference.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.3.</b>
                        
                        Type inference
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.4" data-path="syntax_and_semantics/overloading.html">
            
                
                    <a href="../syntax_and_semantics/overloading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.4.</b>
                        
                        Overloading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.5" data-path="syntax_and_semantics/default_and_named_arguments.html">
            
                
                    <a href="../syntax_and_semantics/default_and_named_arguments.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.5.</b>
                        
                        Default values and named arguments
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.6" data-path="syntax_and_semantics/splats_and_tuples.html">
            
                
                    <a href="../syntax_and_semantics/splats_and_tuples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.6.</b>
                        
                        Splats and tuples
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.7" data-path="syntax_and_semantics/type_restrictions.html">
            
                
                    <a href="../syntax_and_semantics/type_restrictions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.7.</b>
                        
                        Type restrictions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.8" data-path="syntax_and_semantics/return_types.html">
            
                
                    <a href="../syntax_and_semantics/return_types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.8.</b>
                        
                        Return types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.9" data-path="syntax_and_semantics/default_values_named_arguments_splats_tuples_and_overloading.html">
            
                
                    <a href="../syntax_and_semantics/default_values_named_arguments_splats_tuples_and_overloading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.9.</b>
                        
                        Method arguments
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.10" data-path="syntax_and_semantics/operators.html">
            
                
                    <a href="../syntax_and_semantics/operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.10.</b>
                        
                        Operators
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.11" data-path="syntax_and_semantics/visibility.html">
            
                
                    <a href="../syntax_and_semantics/visibility.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.11.</b>
                        
                        Visibility
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.12" data-path="syntax_and_semantics/inheritance.html">
            
                
                    <a href="../syntax_and_semantics/inheritance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.12.</b>
                        
                        Inheritance
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.3.12.1" data-path="syntax_and_semantics/virtual_and_abstract_types.html">
            
                
                    <a href="../syntax_and_semantics/virtual_and_abstract_types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.12.1.</b>
                        
                        Virtual and abstract types
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8.3.13" data-path="syntax_and_semantics/class_variables.html">
            
                
                    <a href="../syntax_and_semantics/class_variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.13.</b>
                        
                        Class variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.3.14" data-path="syntax_and_semantics/finalize.html">
            
                
                    <a href="../syntax_and_semantics/finalize.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.3.14.</b>
                        
                        finalize
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8.4" data-path="syntax_and_semantics/modules.html">
            
                
                    <a href="../syntax_and_semantics/modules.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.4.</b>
                        
                        Modules
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.5" data-path="syntax_and_semantics/generics.html">
            
                
                    <a href="../syntax_and_semantics/generics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.5.</b>
                        
                        Generics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.6" data-path="syntax_and_semantics/structs.html">
            
                
                    <a href="../syntax_and_semantics/structs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.6.</b>
                        
                        Structs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.7" data-path="syntax_and_semantics/constants.html">
            
                
                    <a href="../syntax_and_semantics/constants.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.7.</b>
                        
                        Constants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.8" data-path="syntax_and_semantics/enum.html">
            
                
                    <a href="../syntax_and_semantics/enum.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.8.</b>
                        
                        Enums
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.9" data-path="syntax_and_semantics/blocks_and_procs.html">
            
                
                    <a href="../syntax_and_semantics/blocks_and_procs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.9.</b>
                        
                        Blocks and Procs
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.9.1" data-path="syntax_and_semantics/capturing_blocks.html">
            
                
                    <a href="../syntax_and_semantics/capturing_blocks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.9.1.</b>
                        
                        Capturing blocks
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.9.2" data-path="syntax_and_semantics/proc_literal.html">
            
                
                    <a href="../syntax_and_semantics/proc_literal.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.9.2.</b>
                        
                        Proc literal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.9.3" data-path="syntax_and_semantics/block_forwarding.html">
            
                
                    <a href="../syntax_and_semantics/block_forwarding.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.9.3.</b>
                        
                        Block forwarding
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8.9.4" data-path="syntax_and_semantics/closures.html">
            
                
                    <a href="../syntax_and_semantics/closures.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.9.4.</b>
                        
                        Closures
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8.10" data-path="syntax_and_semantics/alias.html">
            
                
                    <a href="../syntax_and_semantics/alias.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.10.</b>
                        
                        alias
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="syntax_and_semantics/type_reflection.html">
            
                
                    <a href="../syntax_and_semantics/type_reflection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        Type reflection
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.9.1" data-path="syntax_and_semantics/is_a.html">
            
                
                    <a href="../syntax_and_semantics/is_a.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.1.</b>
                        
                        is_a?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9.2" data-path="syntax_and_semantics/nil_question.html">
            
                
                    <a href="../syntax_and_semantics/nil_question.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.2.</b>
                        
                        nil?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9.3" data-path="syntax_and_semantics/responds_to.html">
            
                
                    <a href="../syntax_and_semantics/responds_to.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.3.</b>
                        
                        responds_to?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9.4" data-path="syntax_and_semantics/as.html">
            
                
                    <a href="../syntax_and_semantics/as.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.4.</b>
                        
                        as
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9.5" data-path="syntax_and_semantics/as_question.html">
            
                
                    <a href="../syntax_and_semantics/as_question.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.5.</b>
                        
                        as?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9.6" data-path="syntax_and_semantics/typeof.html">
            
                
                    <a href="../syntax_and_semantics/typeof.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.6.</b>
                        
                        typeof
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="syntax_and_semantics/attributes.html">
            
                
                    <a href="../syntax_and_semantics/attributes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.10.</b>
                        
                        Attributes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="syntax_and_semantics/requiring_files.html">
            
                
                    <a href="../syntax_and_semantics/requiring_files.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.11.</b>
                        
                        Requiring files
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="syntax_and_semantics/low_level_primitives.html">
            
                
                    <a href="../syntax_and_semantics/low_level_primitives.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.</b>
                        
                        Low-level primitives
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.12.1" data-path="syntax_and_semantics/pointerof.html">
            
                
                    <a href="../syntax_and_semantics/pointerof.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.1.</b>
                        
                        pointerof
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12.2" data-path="syntax_and_semantics/sizeof.html">
            
                
                    <a href="../syntax_and_semantics/sizeof.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.2.</b>
                        
                        sizeof
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12.3" data-path="syntax_and_semantics/instance_sizeof.html">
            
                
                    <a href="../syntax_and_semantics/instance_sizeof.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.3.</b>
                        
                        instance_sizeof
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12.4" data-path="syntax_and_semantics/declare_var.html">
            
                
                    <a href="../syntax_and_semantics/declare_var.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.4.</b>
                        
                        Uninitialized variable declaration
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="syntax_and_semantics/exception_handling.html">
            
                
                    <a href="../syntax_and_semantics/exception_handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.13.</b>
                        
                        Exception handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="syntax_and_semantics/compile_time_flags.html">
            
                
                    <a href="../syntax_and_semantics/compile_time_flags.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.14.</b>
                        
                        Compile-time flags
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.14.1" data-path="syntax_and_semantics/cross-compilation.html">
            
                
                    <a href="../syntax_and_semantics/cross-compilation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.14.1.</b>
                        
                        Cross-compilation
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.15" data-path="syntax_and_semantics/macros.html">
            
                
                    <a href="../syntax_and_semantics/macros.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.</b>
                        
                        Macros
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.15.1" data-path="syntax_and_semantics/macros/macro_methods.html">
            
                
                    <a href="../syntax_and_semantics/macros/macro_methods.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.1.</b>
                        
                        Macro methods
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.15.2" data-path="syntax_and_semantics/macros/hooks.html">
            
                
                    <a href="../syntax_and_semantics/macros/hooks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.2.</b>
                        
                        Hooks
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.15.3" data-path="syntax_and_semantics/macros/fresh_variables.html">
            
                
                    <a href="../syntax_and_semantics/macros/fresh_variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.3.</b>
                        
                        Fresh variables
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.16" data-path="syntax_and_semantics/c_bindings/index.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.</b>
                        
                        C bindings
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.16.1" data-path="syntax_and_semantics/c_bindings/lib.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/lib.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.1.</b>
                        
                        lib
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.2" data-path="syntax_and_semantics/c_bindings/fun.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/fun.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.2.</b>
                        
                        fun
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.16.2.1" data-path="syntax_and_semantics/c_bindings/out.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/out.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.2.1.</b>
                        
                        out
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.2.2" data-path="syntax_and_semantics/c_bindings/to_unsafe.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/to_unsafe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.2.2.</b>
                        
                        to_unsafe
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.16.3" data-path="syntax_and_semantics/c_bindings/struct.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/struct.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.3.</b>
                        
                        struct
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.4" data-path="syntax_and_semantics/c_bindings/union.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/union.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.4.</b>
                        
                        union
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.5" data-path="syntax_and_semantics/c_bindings/enum.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/enum.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.5.</b>
                        
                        enum
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.6" data-path="syntax_and_semantics/c_bindings/variables.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/variables.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.6.</b>
                        
                        Variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.7" data-path="syntax_and_semantics/c_bindings/constants.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/constants.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.7.</b>
                        
                        Constants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.8" data-path="syntax_and_semantics/c_bindings/type.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/type.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.8.</b>
                        
                        type
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.9" data-path="syntax_and_semantics/c_bindings/alias.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/alias.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.9.</b>
                        
                        alias
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16.10" data-path="syntax_and_semantics/c_bindings/callbacks.html">
            
                
                    <a href="../syntax_and_semantics/c_bindings/callbacks.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.10.</b>
                        
                        Callbacks
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.17" data-path="syntax_and_semantics/type_grammar.html">
            
                
                    <a href="../syntax_and_semantics/type_grammar.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.17.</b>
                        
                        型別語法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.18" data-path="syntax_and_semantics/unsafe.html">
            
                
                    <a href="../syntax_and_semantics/unsafe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.18.</b>
                        
                        Unsafe code
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="conventions/index.html">
            
                
                    <a href="../conventions/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Conventions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="conventions/coding_style.html">
            
                
                    <a href="../conventions/coding_style.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Coding style
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="conventions/documenting_code.html">
            
                
                    <a href="../conventions/documenting_code.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Documenting code
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="guides/index.html">
            
                
                    <a href="../guides/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Guides
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="guides/concurrency.html">
            
                
                    <a href="../guides/concurrency.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Concurrency
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Crystal 程式語言</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="type-inference">Type inference</h1>
<p><strong>Note</strong>: this applies to the next version of Crystal (0.16.0). Before this version global type inference takes the whole program and all uses into account.</p>
<p>Crystal&apos;s philosophy is to require as few type annotations as possible. However, some type annotatinos are required.</p>
<p>Consider a class definition like this:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span>)
    <span class="hljs-variable">@age</span> = <span class="hljs-number">0</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>We can quickly see that <code>@age</code> is an integer, but we don&apos;t know what&apos;s the type of <code>@name</code>. The compiler could infer its type from all uses of the <code>Person</code> class. However, doing so has a few issues:</p>
<ul>
<li>The type is not obvious for a human reading the code: she would also have to check all uses of <code>Person</code> to find this out.</li>
<li>Some compiler optimizations, like having to analyze a method just once, and incremental compilation, are near impossible to do.</li>
</ul>
<p>As a code base grows, these issues gain more relevance: understanding a project becomes harder, and compile times become unbearable.</p>
<p>For this reason, Crystal needs to know, in an obvious way (as obvious as to a human), the types of instance, <a href="class_variables.html">class</a> and <a href="global_variables.html">global</a> variables.</p>
<p>There are several ways to let Crystal know this.</p>
<h2 id="use-an-explicit-type-annotation">Use an explicit type annotation</h2>
<p>The easiest, but probably most tedious, way is to use explicit type annotations.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-variable">@name</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>
  <span class="hljs-variable">@age</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Int32</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span>)
    <span class="hljs-variable">@age</span> = <span class="hljs-number">0</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="don-t-use-an-explicit-type-annotation">Don&apos;t use an explicit type annotation</h2>
<p>If you omit an explicit type annotation the compiler will try to infer the type of instance, class and global variables using a bunch of syntactic rules.</p>
<p>For a given instance/class/global variable, when a rule can be applied and a type can be guessed, the type is added to a set. When no more rules can be applied, the inferred type will be the <a href="union_types.html">union</a> of those types. Additionally, if the compiler infers that an instance variable isn&apos;t always initialized, it will also include the <a href="literals/nil.html">Nil</a> type.</p>
<p>The rules are many, but usually the first three are most used. There&apos;s no need to remember them all. If the compiler gives an error saying that the type of an instance variable can&apos;t be inferred you can always add an explicit type annotation.</p>
<p>The following rules only mention instance variables, but they apply to class and global variables as well. They are:</p>
<h3 id="1-assigning-a-literal-value">1. Assigning a literal value</h3>
<p>When a literal is assigned to an instance variable, the literal&apos;s type is added to the set. All <a href="literals.html">literals</a> have an associated type.</p>
<p>In the following example, <code>@name</code> is inferred to be <code>String</code> and <code>@age</code> to be <code>Int32</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@name</span> = <span class="hljs-string">&quot;John Doe&quot;</span>
    <span class="hljs-variable">@age</span> = <span class="hljs-number">0</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This rule, and every following rule, will also be applied in methods other than <code>initialize</code>. For example:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lucky_number</span></span>
    <span class="hljs-variable">@lucky_number</span> = <span class="hljs-number">42</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>In the above case, <code>@lucky_number</code> will be inferred to be <code>Int32 | Nil</code>: <code>Int32</code> because 42 was assigned to it, and <code>Nil</code> because it wasn&apos;t assigned in all of the class&apos; initialize methods.</p>
<h3 id="2-assigning-the-result-of-invoking-the-class-method-new">2. Assigning the result of invoking the class method <code>new</code></h3>
<p>When an expression like <code>Type.new(...)</code> is assigned to an instance variable, the type <code>Type</code> is added to the set.</p>
<p>In the following example, <code>@address</code> is inferred to be <code>Address</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@address</span> = <span class="hljs-constant">Address</span>.new(<span class="hljs-string">&quot;somewhere&quot;</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This also is applied to generic types. Here <code>@values</code> is inferred to be <code>Array(Int32)</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Something</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@values</span> = <span class="hljs-constant">Array</span>(<span class="hljs-constant">Int32</span>).new
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p><strong>Note</strong>: a <code>new</code> method might be redefined by a type. In that case the inferred type will be the one returned by <code>new</code>, if it can be inferred using some of the next rules.</p>
<h3 id="3-assigning-a-variable-that-is-a-method-argument-with-a-type-restriction">3. Assigning a variable that is a method argument with a type restriction</h3>
<p>In the following example <code>@name</code> is inferred to be <code>String</code> because the method argument <code>name</code> has a type restriction of type <code>String</code>, and that argument is assigned to <code>@name</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(name <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
    <span class="hljs-variable">@name</span> = name
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Note that the name of the method argument is not important, this works as well:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(obj <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
    <span class="hljs-variable">@name</span> = obj
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Using the shorter syntax to assign an instance variable from a method argument has the same effect:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Also note that the compiler doesn&apos;t check whether method argument is reassigned a different value:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(name <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
    name = <span class="hljs-number">1</span>
    <span class="hljs-variable">@name</span> = name
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>In the above case, the compiler will still infer <code>@name</code> to be <code>String</code>, and later will give a compile time error, when fully typing that method, saying that <code>Int32</code> can&apos;t be assigned to a variable of type <code>String</code>. Use an explicit type annotation if <code>@name</code> isn&apos;t supposed to be a <code>String</code>.</p>
<h3 id="4-assigning-the-result-of-a-class-method-that-has-a-return-type-annotation">4. Assigning the result of a class method that has a return type annotation</h3>
<p>In the following example, <code>@address</code> is inferred to be <code>Address</code>, because the class method <code>Address.unknown</code> has a return type annotation of <code>Address</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@address</span> = <span class="hljs-constant">Address</span>.unkown
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">self</span></span>.unknown <span class="hljs-symbol">:</span> <span class="hljs-constant">Address</span>
    new(<span class="hljs-string">&quot;unknown&quot;</span>)
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>In fact, the above code doesn&apos;t need the return type annotation in <code>self.unknown</code>. The reason is that the compiler will also look at a class method&apos;s body and if it can apply one of the previous rules (it&apos;s a <code>new</code> method, or it&apos;s a literal, etc.) it will infer the type from that expression. So, the above can be simply written like this:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@address</span> = <span class="hljs-constant">Address</span>.unkown
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span></span>
  <span class="hljs-comment"># No need for a return type annotation here</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">self</span></span>.unknown
    new(<span class="hljs-string">&quot;unknown&quot;</span>)
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This extra rule is very convenient because it&apos;s very common to have &quot;constructor-like&quot; class methods in addition to <code>new</code>.</p>
<h3 id="5-assigning-a-variable-that-is-a-method-argument-with-a-default-value">5. Assigning a variable that is a method argument with a default value</h3>
<p>In the following example, because the default value of <code>name</code> is a string literal, and it&apos;s later assigned to <code>@name</code>, <code>String</code> will be added to the set of inferred typed.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(name = <span class="hljs-string">&quot;John Doe&quot;</span>)
    <span class="hljs-variable">@name</span> = name
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This of course also works with the short syntax:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@name</span> = <span class="hljs-string">&quot;John Doe&quot;</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The default value can also be a <code>Type.new(...)</code> method or a class method with a return type annotation.</p>
<h3 id="6-assigning-the-result-of-invoking-a-lib-function">6. Assigning the result of invoking a <code>lib</code> function</h3>
<p>Because a <a href="c_bindings/fun.html">lib function</a> must have explicit types, the compiler can use the return type when assigning it to an instance variable.</p>
<p>In the following example <code>@age</code> is inferred to be <code>Int32</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@age</span> = <span class="hljs-constant">LibPerson</span>.compute_default_age
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">lib</span> <span class="hljs-title">LibPerson</span></span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">compute_default_age</span></span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Int32</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="7-using-an-out-lib-expression">7. Using an <code>out</code> lib expression</h3>
<p>Because a <a href="c_bindings/fun.html">lib function</a> must have explicit types, the compiler can use the <code>out</code> argument&apos;s type, which should be a pointer type, and use the dereferenced type as a guess.</p>
<p>In the following example <code>@age</code> is inferred to be <code>Int32</code>.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-constant">LibPerson</span>.compute_default_age(<span class="hljs-keyword">out</span> <span class="hljs-variable">@age</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">lib</span> <span class="hljs-title">LibPerson</span></span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">compute_default_age</span></span>(age_ptr <span class="hljs-symbol">:</span> <span class="hljs-constant">Int32</span>*)
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="other-rules">Other rules</h3>
<p>The compiler will try to be as smart as possible to require less explicit type annotations. For example, if assigning an <code>if</code> expression, type will be inferred from the <code>then</code> and <code>else</code> branches:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>
    <span class="hljs-variable">@age</span> = some_condition ? <span class="hljs-number">1</span> <span class="hljs-symbol">:</span> <span class="hljs-number">2</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Because the <code>if</code> above (well, technically a ternary operator, but it&apos;s similar to an <code>if</code>) has integer literals, <code>@age</code> is successfully inferred to be <code>Int32</code> without requiring a redundant type annotation.</p>
<p>Another case is <code>||</code> and <code>||=</code>:</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lucky_number</span></span>
    <span class="hljs-variable">@lucky_number</span> ||= <span class="hljs-number">42</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>In the above example <code>@lucky_number</code> will be inferred to be <code>Int32 | Nil</code>. This is very useful for lazily initialized variables.</p>
<p>Constants will also be followed, as it&apos;s pretty simple for the compiler (and a human) to do so.</p>
<pre><code class="lang-crystal"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span></span>
  <span class="hljs-constant">DEFAULT_LUCKY_NUMBER</span> = <span class="hljs-number">42</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(<span class="hljs-variable">@lucky_number</span> = <span class="hljs-constant">DEFAULT_LUCKY_NUMBER</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Here rule 5 (argument&apos;s default value) is used, and because the constant resolves to an integer literal, <code>@lucky_number</code> is inferred to be <code>Int32</code>.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../syntax_and_semantics/methods_and_instance_variables.html" class="navigation navigation-prev " aria-label="Previous page: Methods and instance variables"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../syntax_and_semantics/overloading.html" class="navigation navigation-next " aria-label="Next page: Overloading"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
