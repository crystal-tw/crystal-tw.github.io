<!DOCTYPE html>
<html lang='zh-Hant'>
  <head>
    <meta charset='utf-8'>
    <title>Happy birthday, Crystal! - Crystal 程式語言 
    </title>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link type="text/css" rel="stylesheet" href="/assets/stylesheet.css">
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v1.4.0 -->
<title>Happy birthday, Crystal! - Crystal 程式語言</title>
<meta property="og:title" content="Happy birthday, Crystal!" />
<meta name="description" content="Yesterday Crystal became one year old. Yay! :-)" />
<meta property="og:description" content="Yesterday Crystal became one year old. Yay! :-)" />
<link rel="canonical" href="http://crystal-tw.github.io/2013/09/04/happy-birthday-crystal.html" />
<meta property="og:url" content="http://crystal-tw.github.io/2013/09/04/happy-birthday-crystal.html" />
<meta property="og:site_name" content="Crystal 程式語言" />
<meta property="og:image" content="http://crystal-tw.github.io/images/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-09-04T00:00:00+00:00" />
<link rel="next" href="http://crystal-tw.github.io/2013/09/15/to-proc.html" title="to_proc" />
<link rel="prev" href="http://crystal-tw.github.io/2013/07/13/null-pointer-exception.html" title="Null Pointer Exception" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@asterite" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Happy birthday, Crystal!",
    "image": "http://crystal-tw.github.io/images/icon.png",
    "datePublished": "2013-09-04T00:00:00+00:00",
    "description": "Yesterday Crystal became one year old. Yay! :-)",
    "logo": "http://crystal-tw.github.io/images/crystal-h.png",
    "url": "http://crystal-tw.github.io/2013/09/04/happy-birthday-crystal.html"
  }
</script>
<!-- End Jekyll SEO tag -->
    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
      <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>

      
        <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/asterite.jpg" width="360" height="360" alt="authors/asterite.jpg">
          
          
            <span class="author_name">Ary Borenzweig</span>
          
          
          
            <span class="date">04 Sep 2013</span>
          
        </div>

        <h1 class='title'>Happy birthday, Crystal!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>

      
      <main>
        <div class="container">
  <div class="row post-layout">
    <div class="col m2 share">
      <p class="title small share-title">Share</p>
      <div class="share-list">
        
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2F127.0.0.1%2F2013%2F09%2F04%2Fhappy-birthday-crystal.html&text=Happy+birthday%2C+Crystal%21&via=CrystalLanguage" target="_blank">
          <div class="share-item"><i class="extra-icons twitter gray"></i></div>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F127.0.0.1%2F2013%2F09%2F04%2Fhappy-birthday-crystal.html" target="_blank">
          <div class="share-item"><i class="extra-icons facebook gray"></i></div>
        </a>
        <a href="https://plus.google.com/share?url=https%3A%2F%2F127.0.0.1%2F2013%2F09%2F04%2Fhappy-birthday-crystal.html" target="_blank">
          <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
          </a>
      </div>
    </div>

    <div class="col s12 m9">
      <p>Yesterday Crystal became one year old. Yay! :-)</p>

<p>A lot of things happened since the moment we started this rather ambitious project, and there is still
a lot more to do.</p>

<p>Although its syntax is very similar to Ruby, there are many differences, and every day the distance
is growing bigger.</p>

<p>Here’s a summary of what we have in the language right now.</p>

<h3 id="efficient-code-generation">Efficient code generation</h3>

<p>Crystal is <strong>not</strong> interpreted. It doesn’t have a virtual machine. The code is compiled to
native machine code by using LLVM.</p>

<p>You don’t specify the types of variables, instance variables or method arguments,
like is usually done in statically compiled languages. Instead, Crystal tries to be as
smart as possible and infers the types for you.</p>

<h3 id="primitive-types">Primitive types</h3>

<p>Primitive types map to native machine types.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">true</span>    <span class="c1"># Bool</span>
<span class="mi">1</span>       <span class="c1"># Int32</span>
<span class="mi">1</span><span class="n">_u64</span>   <span class="c1"># UInt64</span>
<span class="mi">1</span><span class="o">.</span><span class="mi">5</span>     <span class="c1"># Float64</span>
<span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="n">_f32</span> <span class="c1"># Float32</span>
<span class="s1">'a'</span>     <span class="c1"># Char</span></code></pre></figure>
</div>

<h3 id="ascii-strings">ASCII Strings</h3>

<p>They come in many flavors, like in Ruby, and they also support interpolation.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">b</span> <span class="o">=</span> <span class="s2">"Hello </span><span class="si">#{</span><span class="n">a</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "Hello World"</span></code></pre></figure>
</div>

<p>We still need to decide what’s the best way to deal with different encodings, so this
is just a temporary implementation.</p>

<p>Did you know that <a href="https://github.com/crystal-lang/crystal/blob/master/src/string.cr">String</a>
is implemented in Crystal itself? There’s just very small magic to make it have the
size and pointer to the chars buffers, but everything else is built on top of that.</p>

<h3 id="symbols">Symbols</h3>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:foo</span></code></pre></figure>
</div>

<p>At runtime, each symbol is represented by a unique integer. A table of integer to string is built for
implementing Symbol#to_s (but there’s no way right now to do String#intern).</p>

<h3 id="union-types">Union types</h3>

<p>You don’t need to specify the type of a variable. If it is assigned multiple types,
it will have those types at compile-time. At run-time it will have only one.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">some_condition</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">else</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span>
<span class="k">end</span>

<span class="c1"># Here a can be an Int32 or Float64</span>

<span class="n">a</span><span class="p">.</span><span class="nf">abs</span>  <span class="c1"># Ok, both Int32 and Float64 define the 'abs' method without arguments</span>
<span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Error, Float64 doesn't have a 'succ' method</span></code></pre></figure>
</div>

<p>You can use “is_a?” to check for a type:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Int32</span><span class="p">)</span>
  <span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Ok, here a can only be an Int32</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>You can even use “responds_to?”:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="nf">responds_to?</span><span class="p">(</span><span class="ss">:succ</span><span class="p">)</span>
  <span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Ok</span>
<span class="k">end</span></code></pre></figure>
</div>

<h3 id="methods">Methods</h3>

<p>In Crystal methods can be overloaded. The overloads come from the number of arguments,
type restrictions and <em>yieldness</em> of a method.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># foo 1</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span>

<span class="c1"># foo 2</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># foo 3</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Float</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">yield</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>      <span class="c1"># Invokes foo 1</span>
<span class="n">foo</span> <span class="mi">1</span>         <span class="c1"># Invokes foo 2</span>
<span class="n">foo</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span>       <span class="c1"># Invokes foo 3</span>
<span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>    <span class="c1"># Invokes foo 4</span></code></pre></figure>
</div>

<p>Contrast this with having to check <strong>at runtime</strong> the number of arguments of the method,
whether a block was given, or which are the types of arguments: we believe this is much more
readable and efficient.</p>

<p>Also, there’s no “wrong number of arguments” exception thrown at runtime: in Crystal
it’s a compile time error.</p>

<p>The last bit, overloading based on whether a method yields or not, will probably change
and needs to be re-thought.</p>

<h3 id="classes">Classes</h3>

<p>No need to specify the types of instance variables, but all types assigned to
an instance variable will make that variable have a union type.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Foo</span>
  <span class="c1"># We prefer getter, setter and property over</span>
  <span class="c1"># attr_reader, attr_writer and attr_accessor</span>
  <span class="n">getter</span> <span class="ss">:value</span>

  <span class="c1"># Note the @value at the argument: this is similar to Coffeescript</span>
  <span class="c1"># and we think it's a nice syntax addition.</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">abs</span> <span class="c1"># Ok</span>

<span class="c1"># At this point @value is an Int32</span>

<span class="n">foo2</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>

<span class="c1"># Because of the last line, @value is now an Int32 or Char.</span>
<span class="c1"># Char doesn't have an 'abs' method, so a compile time error is issued.</span></code></pre></figure>
</div>

<p>If you really need different Foo classes with different types for @value,
you can use a generic class:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="no">T</span><span class="p">)</span>
  <span class="n">getter</span> <span class="ss">:value</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@value</span> <span class="p">:</span> <span class="no">T</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># T is inferred to be an Int32, and foo is a Foo(Int32)</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">abs</span>       <span class="c1"># Ok</span>

<span class="n">foo2</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1"># T is inferred to be a Char, and foo2 is a Foo(Char)</span>
<span class="n">foo2</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">ord</span>            <span class="c1"># Ok</span>

<span class="c1"># You can also explicitly specify the generic type variable</span>
<span class="n">foo3</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">(</span><span class="no">String</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span></code></pre></figure>
</div>

<p>Array and Hash are generic classes too, but they can also be constructed using
literals. When elements are specified, the generic type variables are inferred.
If no element is specified, you have to tell Crystal the generic type variables.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>            <span class="c1"># a is an Array(Int32)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">]</span>        <span class="c1"># b is an Array(Int32 | Float64 | Char)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">of</span> <span class="no">String</span>         <span class="c1"># c is an Array(String), same as doing Array(String).new</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">}</span>     <span class="c1"># d is a Hash(Int32, Int32)</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">{}</span> <span class="n">of</span> <span class="no">String</span> <span class="o">=&gt;</span> <span class="no">Bool</span> <span class="c1"># e is a Hash(String, Bool), same as doing Hash(String, Bool).new</span></code></pre></figure>
</div>

<p>And yes, <a href="https://github.com/crystal-lang/crystal/blob/master/src/array.cr">Array</a> and
<a href="https://github.com/crystal-lang/crystal/blob/master/std/hash.cr">Hash</a> are completely
implemented in Crystal. This makes it very easy for anyone to collaborate on those classes.</p>

<p>We really wanted to avoid having to specify type variables. In fact, we wanted to
avoid having to differentiate between generic and non-generic classes. We spent
a long time (maybe three months?) trying to make it work <strong>efficiently</strong> but we couln’t.
Maybe it doesn’t have an efficient solution. At least we didn’t find anyone who was
able to do it. Generic types are a small sacrifice, but in return we get much
faster compile times.</p>

<h3 id="modules">Modules</h3>

<p>Of course, modules are also present in Crystal, and they can also be generic.</p>

<h3 id="blocks">Blocks</h3>

<p>For now, blocks can’t be saved to a variable or passed to another method. That means,
we still lack closures. It’s not an easy thing to do if we want a smart type inference,
so we need some time to think it over.</p>

<h3 id="bindings-to-c">Bindings to C</h3>

<p>You can declare bindings to C in Crystal, no need to use C, make wrappers or
use another language. For example, this is part of the SDL binding:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">lib</span> <span class="no">LibSDL</span><span class="p">(</span><span class="s2">"SDL"</span><span class="p">)</span>
  <span class="no">INIT_TIMER</span>       <span class="o">=</span> <span class="mh">0x00000001</span><span class="n">_u32</span>
  <span class="no">INIT_AUDIO</span>       <span class="o">=</span> <span class="mh">0x00000010</span><span class="n">_u32</span>
  <span class="c1"># ...</span>
  <span class="n">struct</span> <span class="no">Rect</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="no">Int16</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="p">:</span> <span class="no">UInt16</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
  <span class="n">union</span> <span class="no">Event</span>
    <span class="n">type</span> <span class="p">:</span> <span class="no">UInt8</span>
    <span class="n">key</span> <span class="p">:</span> <span class="no">KeyboardEvent</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
  <span class="n">fun</span> <span class="n">init</span> <span class="o">=</span> <span class="no">SDL_Init</span><span class="p">(</span><span class="n">flags</span> <span class="p">:</span> <span class="no">UInt32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
<span class="k">end</span>

<span class="n">value</span> <span class="o">=</span> <span class="no">LibSDL</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="no">LibSDL</span><span class="o">.</span><span class="no">INIT_TIMER</span><span class="p">)</span></code></pre></figure>
</div>

<h3 id="pointers">Pointers</h3>

<p>You can allocate memory and interface with C by having Pointers as a type in the language.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">values</span> <span class="o">=</span> <span class="no">Pointer</span><span class="p">(</span><span class="no">Int32</span><span class="p">).</span><span class="nf">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Ask for 10 ints</span></code></pre></figure>
</div>

<h3 id="regular-expressions">Regular expressions</h3>

<p>Regular expressions are implemented, for now, with C bindings to the PCRE library. Again,
<a href="https://github.com/crystal-lang/crystal/blob/master/src/regexp.cr">Regexp</a> is entirely written in Crystal.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"foobarbaz"</span> <span class="o">=~</span> <span class="sr">/(.+)bar(.+)/</span> <span class="c1">#=&gt; 0</span>
<span class="vg">$1</span>                           <span class="c1">#=&gt; "foo"</span>
<span class="vg">$2</span>                           <span class="c1">#=&gt; "baz</span></code></pre></figure>
</div>

<h3 id="ranges">Ranges</h3>

<p>Once again, <a href="https://github.com/crystal-lang/crystal/blob/master/src/range.cr">implemented in Crystal</a>.</p>

<h3 id="exceptions">Exceptions</h3>

<p>You can raise and rescue exceptions. They are implemented using libunwind. We are still lacking line
numbers and filenames in the stacktraces.</p>

<h3 id="exporting-c-functions">Exporting C functions</h3>

<p>You can declare functions to be exported to C, so you can compile Crystal code and use it in C
(although there’s still no compiler flag to generate an object file, but it should be easy to implement).</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">fun</span> <span class="n">my_c_function</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="s2">"Yay, I can use string interpolation and call it </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2"> times from C"</span>
<span class="k">end</span></code></pre></figure>
</div>

<h3 id="macros">Macros</h3>

<p>This is an experimental feature of the language where you can generate source code
from AST nodes.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">macro</span> <span class="n">generate_method</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="s2">"
  def </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">
    </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">
  end
  "</span>
<span class="k">end</span>

<span class="n">generate_method</span> <span class="ss">:foo</span><span class="p">,</span> <span class="mi">1</span>

<span class="nb">puts</span> <span class="n">foo</span> <span class="c1"># Prints: 1</span></code></pre></figure>
</div>

<p>The macros getter, setter and property are implemented in a similar way, but we’ve
been thinking of a more powerful and simpler way to achieve the same thing so this
feature might disappear.</p>

<h3 id="yield-with-scope">Yield with scope</h3>

<p>Similar to yield, but changes the implicit scope of the block.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">foo</span>
  <span class="c1"># -1 becomes the default scope where methods</span>
  <span class="c1"># are looked up in the given block</span>
  <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="nf">yield</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="c1"># Invokes "abs" on -1</span>
  <span class="nb">puts</span> <span class="n">abs</span> <span class="o">+</span> <span class="n">x</span> <span class="c1">#=&gt; 3</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This allows writing powerful DSLs with zero overhead: no allocations or closures
are involved.</p>

<p>Something similar can be achieved in Ruby with instance_eval(&amp;block), but for now
we find it easier to implement it this way, and maybe easier to use.</p>

<h3 id="specs">Specs</h3>

<p>We’be built a <a href="https://github.com/crystal-lang/crystal/blob/master/src/spec.cr">very small clone of RSpec</a> and we are using it to test the standard
library as well as the new compiler. Here’s a sample spec for the Array class:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"spec"</span>

<span class="n">describe</span> <span class="s2">"Array"</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">"index"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"performs without a block"</span> <span class="k">do</span>
      <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"performs with a block"</span> <span class="k">do</span>
      <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">}.</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}.</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>So Crystal makes it extremely easy to write tests, and at the same time gives you type safety.
The best of both worlds.</p>

<h2 id="roadmap">Roadmap</h2>

<p>There are a lot more things to implement and we have many ideas to try out.</p>

<ul class="goals">
  <li>We still need a Garbage Collector, and we want an efficient, concurrent one.</li>
  <li>We want to have concurrency primitives, similar to Erlang or Go.</li>
  <li>We want to have better metaprogramming.</li>
  <li>We might have structs, not only for C bindings, to allow writing efficient wrappers and allocating less memory.</li>
  <li>We want tuples, named tuples and named arguments.</li>
</ul>

<p>But the thing we want most right now is to have the compiler written in Crystal. Once
we do this, we won’t need Ruby anymore. We won’t need to maintain two implementations
of the compiler. Compilation times will be reduced drmatically (we hope!).</p>

<p>And also, it’s very likely that the language will grow a lot because
of this, and we will have learned a lot of what it feels like to program in Crystal and what
needs to be improved (debugging and profiling come to our minds). Dog-fooding, they call it :-)</p>

    </div>
    <div class="col m1"></div>
  </div>

  <div class="row disqus">
    <div class="col m2"></div>
    <div class="col s12 m9" id='disqus_thread'>
      <p>Yesterday Crystal became one year old. Yay! :-)</p>

<p>A lot of things happened since the moment we started this rather ambitious project, and there is still
a lot more to do.</p>

<p>Although its syntax is very similar to Ruby, there are many differences, and every day the distance
is growing bigger.</p>

<p>Here’s a summary of what we have in the language right now.</p>

<h3 id="efficient-code-generation">Efficient code generation</h3>

<p>Crystal is <strong>not</strong> interpreted. It doesn’t have a virtual machine. The code is compiled to
native machine code by using LLVM.</p>

<p>You don’t specify the types of variables, instance variables or method arguments,
like is usually done in statically compiled languages. Instead, Crystal tries to be as
smart as possible and infers the types for you.</p>

<h3 id="primitive-types">Primitive types</h3>

<p>Primitive types map to native machine types.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">true</span>    <span class="c1"># Bool</span>
<span class="mi">1</span>       <span class="c1"># Int32</span>
<span class="mi">1</span><span class="n">_u64</span>   <span class="c1"># UInt64</span>
<span class="mi">1</span><span class="o">.</span><span class="mi">5</span>     <span class="c1"># Float64</span>
<span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="n">_f32</span> <span class="c1"># Float32</span>
<span class="s1">'a'</span>     <span class="c1"># Char</span></code></pre></figure>
</div>

<h3 id="ascii-strings">ASCII Strings</h3>

<p>They come in many flavors, like in Ruby, and they also support interpolation.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">b</span> <span class="o">=</span> <span class="s2">"Hello </span><span class="si">#{</span><span class="n">a</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "Hello World"</span></code></pre></figure>
</div>

<p>We still need to decide what’s the best way to deal with different encodings, so this
is just a temporary implementation.</p>

<p>Did you know that <a href="https://github.com/crystal-lang/crystal/blob/master/src/string.cr">String</a>
is implemented in Crystal itself? There’s just very small magic to make it have the
size and pointer to the chars buffers, but everything else is built on top of that.</p>

<h3 id="symbols">Symbols</h3>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:foo</span></code></pre></figure>
</div>

<p>At runtime, each symbol is represented by a unique integer. A table of integer to string is built for
implementing Symbol#to_s (but there’s no way right now to do String#intern).</p>

<h3 id="union-types">Union types</h3>

<p>You don’t need to specify the type of a variable. If it is assigned multiple types,
it will have those types at compile-time. At run-time it will have only one.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">some_condition</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">else</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span>
<span class="k">end</span>

<span class="c1"># Here a can be an Int32 or Float64</span>

<span class="n">a</span><span class="p">.</span><span class="nf">abs</span>  <span class="c1"># Ok, both Int32 and Float64 define the 'abs' method without arguments</span>
<span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Error, Float64 doesn't have a 'succ' method</span></code></pre></figure>
</div>

<p>You can use “is_a?” to check for a type:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Int32</span><span class="p">)</span>
  <span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Ok, here a can only be an Int32</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>You can even use “responds_to?”:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="nf">responds_to?</span><span class="p">(</span><span class="ss">:succ</span><span class="p">)</span>
  <span class="n">a</span><span class="p">.</span><span class="nf">succ</span> <span class="c1"># Ok</span>
<span class="k">end</span></code></pre></figure>
</div>

<h3 id="methods">Methods</h3>

<p>In Crystal methods can be overloaded. The overloads come from the number of arguments,
type restrictions and <em>yieldness</em> of a method.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># foo 1</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span>

<span class="c1"># foo 2</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># foo 3</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Float</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">yield</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>      <span class="c1"># Invokes foo 1</span>
<span class="n">foo</span> <span class="mi">1</span>         <span class="c1"># Invokes foo 2</span>
<span class="n">foo</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span>       <span class="c1"># Invokes foo 3</span>
<span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>    <span class="c1"># Invokes foo 4</span></code></pre></figure>
</div>

<p>Contrast this with having to check <strong>at runtime</strong> the number of arguments of the method,
whether a block was given, or which are the types of arguments: we believe this is much more
readable and efficient.</p>

<p>Also, there’s no “wrong number of arguments” exception thrown at runtime: in Crystal
it’s a compile time error.</p>

<p>The last bit, overloading based on whether a method yields or not, will probably change
and needs to be re-thought.</p>

<h3 id="classes">Classes</h3>

<p>No need to specify the types of instance variables, but all types assigned to
an instance variable will make that variable have a union type.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Foo</span>
  <span class="c1"># We prefer getter, setter and property over</span>
  <span class="c1"># attr_reader, attr_writer and attr_accessor</span>
  <span class="n">getter</span> <span class="ss">:value</span>

  <span class="c1"># Note the @value at the argument: this is similar to Coffeescript</span>
  <span class="c1"># and we think it's a nice syntax addition.</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">abs</span> <span class="c1"># Ok</span>

<span class="c1"># At this point @value is an Int32</span>

<span class="n">foo2</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>

<span class="c1"># Because of the last line, @value is now an Int32 or Char.</span>
<span class="c1"># Char doesn't have an 'abs' method, so a compile time error is issued.</span></code></pre></figure>
</div>

<p>If you really need different Foo classes with different types for @value,
you can use a generic class:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="no">T</span><span class="p">)</span>
  <span class="n">getter</span> <span class="ss">:value</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="vi">@value</span> <span class="p">:</span> <span class="no">T</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># T is inferred to be an Int32, and foo is a Foo(Int32)</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">abs</span>       <span class="c1"># Ok</span>

<span class="n">foo2</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1"># T is inferred to be a Char, and foo2 is a Foo(Char)</span>
<span class="n">foo2</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">ord</span>            <span class="c1"># Ok</span>

<span class="c1"># You can also explicitly specify the generic type variable</span>
<span class="n">foo3</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">(</span><span class="no">String</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span></code></pre></figure>
</div>

<p>Array and Hash are generic classes too, but they can also be constructed using
literals. When elements are specified, the generic type variables are inferred.
If no element is specified, you have to tell Crystal the generic type variables.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>            <span class="c1"># a is an Array(Int32)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">]</span>        <span class="c1"># b is an Array(Int32 | Float64 | Char)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">of</span> <span class="no">String</span>         <span class="c1"># c is an Array(String), same as doing Array(String).new</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">}</span>     <span class="c1"># d is a Hash(Int32, Int32)</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">{}</span> <span class="n">of</span> <span class="no">String</span> <span class="o">=&gt;</span> <span class="no">Bool</span> <span class="c1"># e is a Hash(String, Bool), same as doing Hash(String, Bool).new</span></code></pre></figure>
</div>

<p>And yes, <a href="https://github.com/crystal-lang/crystal/blob/master/src/array.cr">Array</a> and
<a href="https://github.com/crystal-lang/crystal/blob/master/std/hash.cr">Hash</a> are completely
implemented in Crystal. This makes it very easy for anyone to collaborate on those classes.</p>

<p>We really wanted to avoid having to specify type variables. In fact, we wanted to
avoid having to differentiate between generic and non-generic classes. We spent
a long time (maybe three months?) trying to make it work <strong>efficiently</strong> but we couln’t.
Maybe it doesn’t have an efficient solution. At least we didn’t find anyone who was
able to do it. Generic types are a small sacrifice, but in return we get much
faster compile times.</p>

<h3 id="modules">Modules</h3>

<p>Of course, modules are also present in Crystal, and they can also be generic.</p>

<h3 id="blocks">Blocks</h3>

<p>For now, blocks can’t be saved to a variable or passed to another method. That means,
we still lack closures. It’s not an easy thing to do if we want a smart type inference,
so we need some time to think it over.</p>

<h3 id="bindings-to-c">Bindings to C</h3>

<p>You can declare bindings to C in Crystal, no need to use C, make wrappers or
use another language. For example, this is part of the SDL binding:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">lib</span> <span class="no">LibSDL</span><span class="p">(</span><span class="s2">"SDL"</span><span class="p">)</span>
  <span class="no">INIT_TIMER</span>       <span class="o">=</span> <span class="mh">0x00000001</span><span class="n">_u32</span>
  <span class="no">INIT_AUDIO</span>       <span class="o">=</span> <span class="mh">0x00000010</span><span class="n">_u32</span>
  <span class="c1"># ...</span>
  <span class="n">struct</span> <span class="no">Rect</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="no">Int16</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="p">:</span> <span class="no">UInt16</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
  <span class="n">union</span> <span class="no">Event</span>
    <span class="n">type</span> <span class="p">:</span> <span class="no">UInt8</span>
    <span class="n">key</span> <span class="p">:</span> <span class="no">KeyboardEvent</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
  <span class="n">fun</span> <span class="n">init</span> <span class="o">=</span> <span class="no">SDL_Init</span><span class="p">(</span><span class="n">flags</span> <span class="p">:</span> <span class="no">UInt32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
<span class="k">end</span>

<span class="n">value</span> <span class="o">=</span> <span class="no">LibSDL</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="no">LibSDL</span><span class="o">.</span><span class="no">INIT_TIMER</span><span class="p">)</span></code></pre></figure>
</div>

<h3 id="pointers">Pointers</h3>

<p>You can allocate memory and interface with C by having Pointers as a type in the language.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">values</span> <span class="o">=</span> <span class="no">Pointer</span><span class="p">(</span><span class="no">Int32</span><span class="p">).</span><span class="nf">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Ask for 10 ints</span></code></pre></figure>
</div>

<h3 id="regular-expressions">Regular expressions</h3>

<p>Regular expressions are implemented, for now, with C bindings to the PCRE library. Again,
<a href="https://github.com/crystal-lang/crystal/blob/master/src/regexp.cr">Regexp</a> is entirely written in Crystal.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"foobarbaz"</span> <span class="o">=~</span> <span class="sr">/(.+)bar(.+)/</span> <span class="c1">#=&gt; 0</span>
<span class="vg">$1</span>                           <span class="c1">#=&gt; "foo"</span>
<span class="vg">$2</span>                           <span class="c1">#=&gt; "baz</span></code></pre></figure>
</div>

<h3 id="ranges">Ranges</h3>

<p>Once again, <a href="https://github.com/crystal-lang/crystal/blob/master/src/range.cr">implemented in Crystal</a>.</p>

<h3 id="exceptions">Exceptions</h3>

<p>You can raise and rescue exceptions. They are implemented using libunwind. We are still lacking line
numbers and filenames in the stacktraces.</p>

<h3 id="exporting-c-functions">Exporting C functions</h3>

<p>You can declare functions to be exported to C, so you can compile Crystal code and use it in C
(although there’s still no compiler flag to generate an object file, but it should be easy to implement).</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">fun</span> <span class="n">my_c_function</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="s2">"Yay, I can use string interpolation and call it </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2"> times from C"</span>
<span class="k">end</span></code></pre></figure>
</div>

<h3 id="macros">Macros</h3>

<p>This is an experimental feature of the language where you can generate source code
from AST nodes.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">macro</span> <span class="n">generate_method</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="s2">"
  def </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">
    </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">
  end
  "</span>
<span class="k">end</span>

<span class="n">generate_method</span> <span class="ss">:foo</span><span class="p">,</span> <span class="mi">1</span>

<span class="nb">puts</span> <span class="n">foo</span> <span class="c1"># Prints: 1</span></code></pre></figure>
</div>

<p>The macros getter, setter and property are implemented in a similar way, but we’ve
been thinking of a more powerful and simpler way to achieve the same thing so this
feature might disappear.</p>

<h3 id="yield-with-scope">Yield with scope</h3>

<p>Similar to yield, but changes the implicit scope of the block.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">foo</span>
  <span class="c1"># -1 becomes the default scope where methods</span>
  <span class="c1"># are looked up in the given block</span>
  <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="nf">yield</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">foo</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="c1"># Invokes "abs" on -1</span>
  <span class="nb">puts</span> <span class="n">abs</span> <span class="o">+</span> <span class="n">x</span> <span class="c1">#=&gt; 3</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This allows writing powerful DSLs with zero overhead: no allocations or closures
are involved.</p>

<p>Something similar can be achieved in Ruby with instance_eval(&amp;block), but for now
we find it easier to implement it this way, and maybe easier to use.</p>

<h3 id="specs">Specs</h3>

<p>We’be built a <a href="https://github.com/crystal-lang/crystal/blob/master/src/spec.cr">very small clone of RSpec</a> and we are using it to test the standard
library as well as the new compiler. Here’s a sample spec for the Array class:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"spec"</span>

<span class="n">describe</span> <span class="s2">"Array"</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">"index"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"performs without a block"</span> <span class="k">do</span>
      <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"performs with a block"</span> <span class="k">do</span>
      <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">}.</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">a</span><span class="p">.</span><span class="nf">index</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}.</span><span class="nf">should</span> <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>So Crystal makes it extremely easy to write tests, and at the same time gives you type safety.
The best of both worlds.</p>

<h2 id="roadmap">Roadmap</h2>

<p>There are a lot more things to implement and we have many ideas to try out.</p>

<ul class="goals">
  <li>We still need a Garbage Collector, and we want an efficient, concurrent one.</li>
  <li>We want to have concurrency primitives, similar to Erlang or Go.</li>
  <li>We want to have better metaprogramming.</li>
  <li>We might have structs, not only for C bindings, to allow writing efficient wrappers and allocating less memory.</li>
  <li>We want tuples, named tuples and named arguments.</li>
</ul>

<p>But the thing we want most right now is to have the compiler written in Crystal. Once
we do this, we won’t need Ruby anymore. We won’t need to maintain two implementations
of the compiler. Compilation times will be reduced drmatically (we hope!).</p>

<p>And also, it’s very likely that the language will grow a lot because
of this, and we will have learned a lot of what it feels like to program in Crystal and what
needs to be improved (debugging and profiling come to our minds). Dog-fooding, they call it :-)</p>

    </div>
    <div class="col m1"></div>
  </div>
</div>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'crystal-lang'; // required: replace example with your forum shortname
  var disqus_identifier = '/2013/09/04/happy-birthday-crystal';
  var disqus_title = "Happy birthday, Crystal!";
  var disqus_url = "http://crystal-lang.org//2013/09/04/happy-birthday-crystal.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
  Please enable JavaScript to view the
  <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
  comments powered by
  <span class='logo-disqus'>Disqus</span>
</a>

      </main>
      <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal" style="margin-top: -.5em;">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
			<br />
			本站正體中文（臺灣）翻譯由 
			<a href='https://github.com/crystal-tw' target='_blank'>
				Crystal-TW
			</a>
			社群貢獻。
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born &amp; raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

    </div>

    <script id="dsq-count-scr" src="//crystal-lang.disqus.com/count.js" async></script>
    <script type="text/javascript" src="/assets/bundle.js"></script>
    <!-- Disable original GA temporary
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>
-->

  </body>
</html>
