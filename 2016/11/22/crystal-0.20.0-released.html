<!DOCTYPE html>
<html lang='zh-Hant'>
  <head>
    <meta charset='utf-8'>
    <title>Crystal 0.20.0 released! - Crystal 程式語言 
    </title>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link type="text/css" rel="stylesheet" href="/assets/stylesheet.css">
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v1.4.0 -->
<title>Crystal 0.20.0 released! - Crystal 程式語言</title>
<meta property="og:title" content="Crystal 0.20.0 released!" />
<meta name="description" content="Crystal 0.20.0 has been released!" />
<meta property="og:description" content="Crystal 0.20.0 has been released!" />
<link rel="canonical" href="http://crystal-tw.github.io/2016/11/22/crystal-0.20.0-released.html" />
<meta property="og:url" content="http://crystal-tw.github.io/2016/11/22/crystal-0.20.0-released.html" />
<meta property="og:site_name" content="Crystal 程式語言" />
<meta property="og:image" content="http://crystal-tw.github.io/images/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-11-22T00:00:00+00:00" />
<link rel="next" href="http://crystal-tw.github.io/2016/12/26/insert-into-shard-values-crystal-db.html" title="INSERT INTO shard VALUES (&quot;crystal-db&quot;)" />
<link rel="prev" href="http://crystal-tw.github.io/2016/09/09/a-story-of-compromises-and-types.html" title="A story of compromises and types" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@asterite" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Crystal 0.20.0 released!",
    "image": "http://crystal-tw.github.io/images/icon.png",
    "datePublished": "2016-11-22T00:00:00+00:00",
    "description": "Crystal 0.20.0 has been released!",
    "logo": "http://crystal-tw.github.io/images/crystal-h.png",
    "url": "http://crystal-tw.github.io/2016/11/22/crystal-0.20.0-released.html"
  }
</script>
<!-- End Jekyll SEO tag -->
    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
      <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>

      
        <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/asterite.jpg" width="360" height="360" alt="authors/asterite.jpg">
          
          
            <span class="author_name">Ary Borenzweig</span>
          
          
          
            <span class="date">22 Nov 2016</span>
          
        </div>

        <h1 class='title'>Crystal 0.20.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>

      
      <main>
        <div class="container">
  <div class="row post-layout">
    <div class="col m2 share">
      <p class="title small share-title">Share</p>
      <div class="share-list">
        
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2F127.0.0.1%2F2016%2F11%2F22%2Fcrystal-0.20.0-released.html&text=Crystal+0.20.0+released%21&via=CrystalLanguage" target="_blank">
          <div class="share-item"><i class="extra-icons twitter gray"></i></div>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F127.0.0.1%2F2016%2F11%2F22%2Fcrystal-0.20.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons facebook gray"></i></div>
        </a>
        <a href="https://plus.google.com/share?url=https%3A%2F%2F127.0.0.1%2F2016%2F11%2F22%2Fcrystal-0.20.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
          </a>
      </div>
    </div>

    <div class="col s12 m9">
      <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.20.0">Crystal 0.20.0</a> has been released!</p>

<p>Aside from the usual bugfixes and some performance improvements there’s
a lot of new stuff here.</p>

<h2 id="shards-070">Shards 0.7.0</h2>

<p>Crystal 0.20.0 comes with <a href="https://github.com/crystal-lang/shards/releases/tag/v0.7.0">version 0.7.0 of shards</a>,
mostly maintained by <a href="https://github.com/ysbaddaden">Julien Portalier</a>,
whichs has a few new goodies like a <code class="highlighter-rouge">build</code> command and informational
<code class="highlighter-rouge">crystal</code> (version) and <code class="highlighter-rouge">libraries</code> entries in the <code class="highlighter-rouge">shard.yml</code> file.
Support for GitLab dependencies was also added.</p>

<h2 id="line-and-file-number-information-in-backtraces">Line and file number information in backtraces</h2>

<p><a href="https://github.com/ysbaddaden">Julien Portalier</a> also added
<a href="https://github.com/crystal-lang/crystal/pull/3303">line and file number information to exception backtraces</a>
when programs are compiled with <code class="highlighter-rouge">-d</code> or <code class="highlighter-rouge">--debug</code>.
For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># example.cr</span>

<span class="k">def</span> <span class="nf">foo</span>
  <span class="n">bar</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">bar</span>
  <span class="k">raise</span> <span class="s2">"OH NO!"</span>
<span class="k">end</span>

<span class="n">foo</span></code></pre></figure>
</div>

<p>Compiling and running:</p>

<pre class="code">
$ crystal build example.cr -d
$ dsymutil --flat example # only needed on Mac OSX
$ ./example
OH NO! (Exception)
0x434f00: *bar:NoReturn at /opt/crystal/example.cr 8:3
0x434ee6: ??? at /opt/crystal/example.cr 4:3
0x431273: ??? at /opt/crystal/example.cr 11:1
0x434da9: main at /root/.cache/crystal/macro93695696.cr 12:15
0x7f9c98798f45: __libc_start_main at ??
0x430c29: ??? at ??
0x0: ??? at ??
</pre>

<p>File, line and column numbers appear on the right side. There’s still some
things to improve here, but this is definitely and improvement and now
it’s so much easier to trace an exception back to the source code.</p>

<h2 id="arm-and-aarch64-support">ARM and AArch64 support</h2>

<p><a href="https://github.com/ysbaddaden">Julien Portalier</a> is also the one who
<a href="https://github.com/crystal-lang/crystal/pull/3424">added</a>
support for these platforms.</p>

<h2 id="llvm-39-support">LLVM 3.9 support</h2>

<p>By… guess who? <a href="https://github.com/ysbaddaden">Julien Portalier</a> once again!
If we had something like “Crystal Awards”, well, now we know who would get
the first place prize, right? ;-)</p>

<h2 id="http-client-and-server-streaming">HTTP client and server streaming</h2>

<p>Before 0.20.0 an <code class="highlighter-rouge">HTTP::Server</code> handler would receive a request with its
entire body already loaded in memory. This wasn’t optimal, as maybe the
body is needed, or it needs to be streamed. 0.20.0 introduces this (breaking)
change. So, for example, one can stream a request directly into a JSON-mapped
object, thus avoiding many intermediate memory allocations. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"http/server"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="k">class</span> <span class="nc">Point</span>
  <span class="nc">JSON</span><span class="p">.</span><span class="nf">mapping</span> <span class="ss">x: </span><span class="no">Float64</span><span class="p">,</span> <span class="ss">y: </span><span class="no">Float64</span>
<span class="k">end</span>

<span class="c1"># Accepts a JSON object representing a point and</span>
<span class="c1"># returns its absolute value (distance)</span>
<span class="n">server</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">4567</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">request</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">request</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="nf">response</span>
  <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">body</span>
  <span class="k">if</span> <span class="n">body</span>
    <span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">abs</span> <span class="o">=</span> <span class="no">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="nf">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="p">.</span><span class="nf">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"application/json"</span>
    <span class="p">{</span><span class="ss">abs: </span><span class="n">abs</span><span class="p">}.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">status_code</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># bad request</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"Missing body"</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="s2">"Listening on port 4567"</span>
<span class="n">server</span><span class="p">.</span><span class="nf">listen</span></code></pre></figure>
</div>

<p>And then:</p>

<pre class="code">
$ curl localhost:4567 -XPOST --data '{"x": 3, "y": 4}'
{"abs":5.0}
</pre>

<p>Also, an <code class="highlighter-rouge">IO</code> can be passed into an <code class="highlighter-rouge">HTTP::Client</code> when perfoming a POST or PUT,
so you can now upload a file very easily:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"http/client"</span>

<span class="n">response</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"some_file.txt"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="no">HTTP</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"http://example.com"</span><span class="p">,</span> <span class="ss">body: </span><span class="n">file</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>
</div>

<h2 id="unicode-aware-methods-for-string-and-char">Unicode aware methods for String and Char</h2>

<p>Methods like <code class="highlighter-rouge">String#downcase</code> and <code class="highlighter-rouge">String#upcase</code> are now unicode aware.</p>

<p>Where previously a program behaved like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"RubyConf 2016 at São Paulo was awesome!"</span><span class="p">.</span><span class="nf">upcase</span>
  <span class="c1"># =&gt; "RUBYCONF 2016 AT SãO PAULO WAS AWESOME!"</span></code></pre></figure>
</div>

<p>(notice the small ‘ã’)</p>

<p>Now it behaves correctly:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"RubyConf 2016 at São Paulo was awesome!"</span><span class="p">.</span><span class="nf">upcase</span>
  <span class="c1"># =&gt; "RUBYCONF 2016 AT SÃO PAULO WAS AWESOME!"</span></code></pre></figure>
</div>

<p>This of course works for any language, and even some complex ligatures are
handled:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"ЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЁЯЧСМИТЬБЮ"</span><span class="p">.</span><span class="nf">downcase</span>
  <span class="c1"># =&gt; "йцукенгшщзхъфывапролджэёячсмитьбю"</span>
<span class="s2">"baﬄe"</span><span class="p">.</span><span class="nf">upcase</span> <span class="c1"># =&gt; "BAFFLE"</span></code></pre></figure>
</div>

<p>(The last example has ‘ﬄ’, which is a single character, but expands to
three when upcased)</p>

<p>And even turkic is supported, where uppercase “i” is “İ” (an “I” with a dot):</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"aeıiou"</span><span class="p">.</span><span class="nf">upcase</span><span class="p">(</span><span class="no">Unicode</span><span class="o">::</span><span class="no">CaseOptions</span><span class="o">::</span><span class="no">Turkic</span><span class="p">)</span>
  <span class="c1"># =&gt; "AEIİOU"</span></code></pre></figure>
</div>

<h2 id="random-enhancements">Random enhancements</h2>

<p>These are not random enhancements, but rather enhancements to the
<a href="https://crystal-lang.org/api/0.20.0/Random.html">Random module</a>.
Specifically, the ability to <a href="https://github.com/crystal-lang/crystal/pull/3402">generate random integers of any type
and any range</a>,
without overflow issues.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">rand</span><span class="p">(</span><span class="no">Int64</span><span class="o">::</span><span class="no">MIN</span><span class="p">.</span><span class="nf">.</span><span class="no">Int64</span><span class="o">::</span><span class="no">MAX</span><span class="p">)</span> <span class="c1"># =&gt; 4544345849288905241</span></code></pre></figure>
</div>

<p>Thank you
<a href="https://github.com/BlaXpirit">Oleh Prypin</a> for another
excellent contribution!</p>

<h2 id="optimized-arraysort">Optimized Array#sort</h2>

<p><a href="https://github.com/c910335">Tatsujin Chin</a> sent a PR that
replaces the old quicksort implementation with an
<a href="https://en.wikipedia.org/wiki/Introsort">introsort</a> one.
The end result is that this is now not only faster than the
old implementation, but also
<a href="https://gist.github.com/firejox/4d300495811c1dda65fefc1b76fc57b6">faster than implementations in other languages</a>,
like c’s <code class="highlighter-rouge">qsort</code> and c++’s <code class="highlighter-rouge">std::sort</code>. Super thank you,
Tatsujin Chin!</p>

<h2 id="api-docs-have-a-nicer-style">API docs have a nicer style</h2>

<p>The style improvements include font changes and layout fixes.
<a href="https://crystal-lang.org/api">Take a look!</a></p>

<p>Special handling of common comments like TODO, OPTIMIZE and DEPRECATED
was also added, and is now shown highlighted. Thank you
<a href="https://github.com/samueleaton">Sam Eaton</a>!</p>

<h2 id="and-more">And more…</h2>

<p>Make sure to read the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.20.0">full changelog</a>
for all the details, and upgrade instruccions due to some breaking changes.</p>

<p>We’d also like to thank everyone else that made this release possible
with their contributions, reviews and suggestions.</p>

    </div>
    <div class="col m1"></div>
  </div>

  <div class="row disqus">
    <div class="col m2"></div>
    <div class="col s12 m9" id='disqus_thread'>
      <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.20.0">Crystal 0.20.0</a> has been released!</p>

<p>Aside from the usual bugfixes and some performance improvements there’s
a lot of new stuff here.</p>

<h2 id="shards-070">Shards 0.7.0</h2>

<p>Crystal 0.20.0 comes with <a href="https://github.com/crystal-lang/shards/releases/tag/v0.7.0">version 0.7.0 of shards</a>,
mostly maintained by <a href="https://github.com/ysbaddaden">Julien Portalier</a>,
whichs has a few new goodies like a <code class="highlighter-rouge">build</code> command and informational
<code class="highlighter-rouge">crystal</code> (version) and <code class="highlighter-rouge">libraries</code> entries in the <code class="highlighter-rouge">shard.yml</code> file.
Support for GitLab dependencies was also added.</p>

<h2 id="line-and-file-number-information-in-backtraces">Line and file number information in backtraces</h2>

<p><a href="https://github.com/ysbaddaden">Julien Portalier</a> also added
<a href="https://github.com/crystal-lang/crystal/pull/3303">line and file number information to exception backtraces</a>
when programs are compiled with <code class="highlighter-rouge">-d</code> or <code class="highlighter-rouge">--debug</code>.
For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># example.cr</span>

<span class="k">def</span> <span class="nf">foo</span>
  <span class="n">bar</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">bar</span>
  <span class="k">raise</span> <span class="s2">"OH NO!"</span>
<span class="k">end</span>

<span class="n">foo</span></code></pre></figure>
</div>

<p>Compiling and running:</p>

<pre class="code">
$ crystal build example.cr -d
$ dsymutil --flat example # only needed on Mac OSX
$ ./example
OH NO! (Exception)
0x434f00: *bar:NoReturn at /opt/crystal/example.cr 8:3
0x434ee6: ??? at /opt/crystal/example.cr 4:3
0x431273: ??? at /opt/crystal/example.cr 11:1
0x434da9: main at /root/.cache/crystal/macro93695696.cr 12:15
0x7f9c98798f45: __libc_start_main at ??
0x430c29: ??? at ??
0x0: ??? at ??
</pre>

<p>File, line and column numbers appear on the right side. There’s still some
things to improve here, but this is definitely and improvement and now
it’s so much easier to trace an exception back to the source code.</p>

<h2 id="arm-and-aarch64-support">ARM and AArch64 support</h2>

<p><a href="https://github.com/ysbaddaden">Julien Portalier</a> is also the one who
<a href="https://github.com/crystal-lang/crystal/pull/3424">added</a>
support for these platforms.</p>

<h2 id="llvm-39-support">LLVM 3.9 support</h2>

<p>By… guess who? <a href="https://github.com/ysbaddaden">Julien Portalier</a> once again!
If we had something like “Crystal Awards”, well, now we know who would get
the first place prize, right? ;-)</p>

<h2 id="http-client-and-server-streaming">HTTP client and server streaming</h2>

<p>Before 0.20.0 an <code class="highlighter-rouge">HTTP::Server</code> handler would receive a request with its
entire body already loaded in memory. This wasn’t optimal, as maybe the
body is needed, or it needs to be streamed. 0.20.0 introduces this (breaking)
change. So, for example, one can stream a request directly into a JSON-mapped
object, thus avoiding many intermediate memory allocations. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"http/server"</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="k">class</span> <span class="nc">Point</span>
  <span class="nc">JSON</span><span class="p">.</span><span class="nf">mapping</span> <span class="ss">x: </span><span class="no">Float64</span><span class="p">,</span> <span class="ss">y: </span><span class="no">Float64</span>
<span class="k">end</span>

<span class="c1"># Accepts a JSON object representing a point and</span>
<span class="c1"># returns its absolute value (distance)</span>
<span class="n">server</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">4567</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">request</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">request</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="nf">response</span>
  <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">body</span>
  <span class="k">if</span> <span class="n">body</span>
    <span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">abs</span> <span class="o">=</span> <span class="no">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="nf">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">point</span><span class="p">.</span><span class="nf">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"application/json"</span>
    <span class="p">{</span><span class="ss">abs: </span><span class="n">abs</span><span class="p">}.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">status_code</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># bad request</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"Missing body"</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="s2">"Listening on port 4567"</span>
<span class="n">server</span><span class="p">.</span><span class="nf">listen</span></code></pre></figure>
</div>

<p>And then:</p>

<pre class="code">
$ curl localhost:4567 -XPOST --data '{"x": 3, "y": 4}'
{"abs":5.0}
</pre>

<p>Also, an <code class="highlighter-rouge">IO</code> can be passed into an <code class="highlighter-rouge">HTTP::Client</code> when perfoming a POST or PUT,
so you can now upload a file very easily:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"http/client"</span>

<span class="n">response</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"some_file.txt"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="no">HTTP</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"http://example.com"</span><span class="p">,</span> <span class="ss">body: </span><span class="n">file</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>
</div>

<h2 id="unicode-aware-methods-for-string-and-char">Unicode aware methods for String and Char</h2>

<p>Methods like <code class="highlighter-rouge">String#downcase</code> and <code class="highlighter-rouge">String#upcase</code> are now unicode aware.</p>

<p>Where previously a program behaved like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"RubyConf 2016 at São Paulo was awesome!"</span><span class="p">.</span><span class="nf">upcase</span>
  <span class="c1"># =&gt; "RUBYCONF 2016 AT SãO PAULO WAS AWESOME!"</span></code></pre></figure>
</div>

<p>(notice the small ‘ã’)</p>

<p>Now it behaves correctly:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"RubyConf 2016 at São Paulo was awesome!"</span><span class="p">.</span><span class="nf">upcase</span>
  <span class="c1"># =&gt; "RUBYCONF 2016 AT SÃO PAULO WAS AWESOME!"</span></code></pre></figure>
</div>

<p>This of course works for any language, and even some complex ligatures are
handled:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"ЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЁЯЧСМИТЬБЮ"</span><span class="p">.</span><span class="nf">downcase</span>
  <span class="c1"># =&gt; "йцукенгшщзхъфывапролджэёячсмитьбю"</span>
<span class="s2">"baﬄe"</span><span class="p">.</span><span class="nf">upcase</span> <span class="c1"># =&gt; "BAFFLE"</span></code></pre></figure>
</div>

<p>(The last example has ‘ﬄ’, which is a single character, but expands to
three when upcased)</p>

<p>And even turkic is supported, where uppercase “i” is “İ” (an “I” with a dot):</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"aeıiou"</span><span class="p">.</span><span class="nf">upcase</span><span class="p">(</span><span class="no">Unicode</span><span class="o">::</span><span class="no">CaseOptions</span><span class="o">::</span><span class="no">Turkic</span><span class="p">)</span>
  <span class="c1"># =&gt; "AEIİOU"</span></code></pre></figure>
</div>

<h2 id="random-enhancements">Random enhancements</h2>

<p>These are not random enhancements, but rather enhancements to the
<a href="https://crystal-lang.org/api/0.20.0/Random.html">Random module</a>.
Specifically, the ability to <a href="https://github.com/crystal-lang/crystal/pull/3402">generate random integers of any type
and any range</a>,
without overflow issues.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">rand</span><span class="p">(</span><span class="no">Int64</span><span class="o">::</span><span class="no">MIN</span><span class="p">.</span><span class="nf">.</span><span class="no">Int64</span><span class="o">::</span><span class="no">MAX</span><span class="p">)</span> <span class="c1"># =&gt; 4544345849288905241</span></code></pre></figure>
</div>

<p>Thank you
<a href="https://github.com/BlaXpirit">Oleh Prypin</a> for another
excellent contribution!</p>

<h2 id="optimized-arraysort">Optimized Array#sort</h2>

<p><a href="https://github.com/c910335">Tatsujin Chin</a> sent a PR that
replaces the old quicksort implementation with an
<a href="https://en.wikipedia.org/wiki/Introsort">introsort</a> one.
The end result is that this is now not only faster than the
old implementation, but also
<a href="https://gist.github.com/firejox/4d300495811c1dda65fefc1b76fc57b6">faster than implementations in other languages</a>,
like c’s <code class="highlighter-rouge">qsort</code> and c++’s <code class="highlighter-rouge">std::sort</code>. Super thank you,
Tatsujin Chin!</p>

<h2 id="api-docs-have-a-nicer-style">API docs have a nicer style</h2>

<p>The style improvements include font changes and layout fixes.
<a href="https://crystal-lang.org/api">Take a look!</a></p>

<p>Special handling of common comments like TODO, OPTIMIZE and DEPRECATED
was also added, and is now shown highlighted. Thank you
<a href="https://github.com/samueleaton">Sam Eaton</a>!</p>

<h2 id="and-more">And more…</h2>

<p>Make sure to read the <a href="https://github.com/crystal-lang/crystal/releases/tag/0.20.0">full changelog</a>
for all the details, and upgrade instruccions due to some breaking changes.</p>

<p>We’d also like to thank everyone else that made this release possible
with their contributions, reviews and suggestions.</p>

    </div>
    <div class="col m1"></div>
  </div>
</div>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'crystal-lang'; // required: replace example with your forum shortname
  var disqus_identifier = '/2016/11/22/crystal-0.20.0-released';
  var disqus_title = "Crystal 0.20.0 released!";
  var disqus_url = "http://crystal-lang.org//2016/11/22/crystal-0.20.0-released.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
  Please enable JavaScript to view the
  <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
  comments powered by
  <span class='logo-disqus'>Disqus</span>
</a>

      </main>
      <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal" style="margin-top: -.5em;">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
			<br />
			本站正體中文（臺灣）翻譯由 
			<a href='https://github.com/crystal-tw' target='_blank'>
				Crystal-TW
			</a>
			社群貢獻。
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born &amp; raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

    </div>

    <script id="dsq-count-scr" src="//crystal-lang.disqus.com/count.js" async></script>
    <script type="text/javascript" src="/assets/bundle.js"></script>
    <!-- Disable original GA temporary
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>
-->

  </body>
</html>
