<!DOCTYPE html>
<html lang='zh-Hant'>
  <head>
    <meta charset='utf-8'>
    <title>Crystal 0.11.0 released! - Crystal 程式語言 
    </title>
    <!-- Import Google Icon Font -->
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons|Roboto+Mono' rel='stylesheet'>
    <link type="text/css" rel="stylesheet" href="/assets/stylesheet.css">
    <link href='/feed.xml' rel='alternate' title='Atom 1.0' type='application/atom+xml'>
    <link href='/favicon.png' rel='icon' type='image/png'>
    <link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <!-- Begin Jekyll SEO tag v1.4.0 -->
<title>Crystal 0.11.0 released! - Crystal 程式語言</title>
<meta property="og:title" content="Crystal 0.11.0 released!" />
<meta name="description" content="Crystal 0.11.0 has been released!" />
<meta property="og:description" content="Crystal 0.11.0 has been released!" />
<link rel="canonical" href="http://crystal-tw.github.io/2016/01/23/crystal-0.11.0-released.html" />
<meta property="og:url" content="http://crystal-tw.github.io/2016/01/23/crystal-0.11.0-released.html" />
<meta property="og:site_name" content="Crystal 程式語言" />
<meta property="og:image" content="http://crystal-tw.github.io/images/icon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-01-23T00:00:00+00:00" />
<link rel="next" href="http://crystal-tw.github.io/2016/02/16/crystal-0.12.0-released.html" title="Crystal 0.12.0 released!" />
<link rel="prev" href="http://crystal-tw.github.io/2015/12/24/the-future-of-crystal.html" title="The future of Crystal" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@CrystalLanguage" />
<meta name="twitter:creator" content="@asterite" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Crystal 0.11.0 released!",
    "image": "http://crystal-tw.github.io/images/icon.png",
    "datePublished": "2016-01-23T00:00:00+00:00",
    "description": "Crystal 0.11.0 has been released!",
    "logo": "http://crystal-tw.github.io/images/crystal-h.png",
    "url": "http://crystal-tw.github.io/2016/01/23/crystal-0.11.0-released.html"
  }
</script>
<!-- End Jekyll SEO tag -->
    <!-- Let browser know website is optimized for mobile -->
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src='https://code.jquery.com/jquery-3.1.1.min.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="wrapper ">
      <nav role='navigation'>
  <div class='nav-wrapper no-select'>
    
      <a class='brand-logo' id='logo-container'>
        <canvas height='120' id='logo-canvas' style='cursor:move' width='120'></canvas>
      </a>
    
    <ul class='right hide-on-med-and-down' id='nav-desktop'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <ul class='side-nav' id='nav-mobile'>
      

  

  
    <li>
      <a href="/" >
        
          Home
        
      </a>
    </li>
  

  
    <li>
      <a href="/blog/" >
        
          Blog
        
      </a>
    </li>
  

  
    <li>
      <a href="/sponsors/" >
        
          Sponsors
        
      </a>
    </li>
  

  
    <li>
      <a href="/community/" >
        
          Community
        
      </a>
    </li>
  

  
    <li>
      <a href="/media/" >
        
          Media
        
      </a>
    </li>
  

<li>
  <a href='http://tw.crystal-lang.org/docs/' target="_blank">入門文件</a>
</li>
<li>
  <a href='https://crystal-lang.org/api/' target="_blank">API</a>
</li>
<li>
  <a href='https://github.com/crystal-lang/crystal' target="_blank">GitHub</a>
</li>


    </ul>
    <a class='button-collapse' data-activates='nav-mobile' href='#'>
      <i class='material-icons'>menu</i>
    </a>
  </div>
</nav>

      
        <div class='post-header'>
  <div class="container">
    <div class='valign row'>
      <div class="col m2"></div>
      <div class="col s12 m9">
        <div class="author small">
          
          
            <img src="/assets/authors/asterite.jpg" width="360" height="360" alt="authors/asterite.jpg">
          
          
            <span class="author_name">Ary Borenzweig</span>
          
          
          
            <span class="date">23 Jan 2016</span>
          
        </div>

        <h1 class='title'>Crystal 0.11.0 released!</h1>
      </div>
      <div class="col m1"></div>
    </div>
  </div>
</div>

      
      <main>
        <div class="container">
  <div class="row post-layout">
    <div class="col m2 share">
      <p class="title small share-title">Share</p>
      <div class="share-list">
        
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2F127.0.0.1%2F2016%2F01%2F23%2Fcrystal-0.11.0-released.html&text=Crystal+0.11.0+released%21&via=CrystalLanguage" target="_blank">
          <div class="share-item"><i class="extra-icons twitter gray"></i></div>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F127.0.0.1%2F2016%2F01%2F23%2Fcrystal-0.11.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons facebook gray"></i></div>
        </a>
        <a href="https://plus.google.com/share?url=https%3A%2F%2F127.0.0.1%2F2016%2F01%2F23%2Fcrystal-0.11.0-released.html" target="_blank">
          <div class="share-item"><i class="extra-icons google_plus gray"></i></div>
          </a>
      </div>
    </div>

    <div class="col s12 m9">
      <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.11.0">Crystal 0.11.0</a> has been released!</p>

<p>This release comes with syntax and semantic changes that favor consistency, standard library refactors,
many performance improvements and bug fixes. A new version of <a href="https://github.com/ysbaddaden/shards">shards</a>
is included.</p>

<p>Read the full changelog <a href="https://github.com/crystal-lang/crystal/releases/tag/0.11.0">here</a>.</p>

<h2 id="syntax-changes">Syntax changes</h2>

<h3 id="type-declarations-and-uninitialized-variables">Type declarations and uninitialized variables</h3>

<p>Before this release, <code class="highlighter-rouge">::</code> was used to declare the type of instance variables.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Point</span>
  <span class="vi">@x</span> <span class="o">::</span> <span class="no">Int32</span>
  <span class="vi">@y</span> <span class="o">::</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Additionally, <code class="highlighter-rouge">::</code> inside a method had the meaning of declaring a variable with uninitialized (unsafe) contents:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">method</span>
  <span class="c1"># Allocate stack memory, don't zero it</span>
  <span class="n">buffer</span> <span class="o">::</span> <span class="no">UInt8</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This was confusing, as a same syntax had two meanings. Now, the <code class="highlighter-rouge">::</code> syntax is gone. To declare the type
of a variable you use a single colon (<code class="highlighter-rouge">:</code>):</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Point</span>
  <span class="vi">@x</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="vi">@y</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This is also consistent with the syntax of type restrictions:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>To declare a variable with uninitialized content you now do:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">method</span>
  <span class="c1"># Allocate stack memory, don't zero it</span>
  <span class="n">buffer</span> <span class="o">=</span> <span class="n">uninitialized</span> <span class="no">UInt8</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>which is much more explicit and clear.</p>

<p>Additionally, type annotations are now allowed in class and global variables.</p>

<p>To upgrade your code to this new syntax, just run <code class="highlighter-rouge">crystal tool format</code> on your project: the formatter still
understand the old syntax and will modify your code to use the new syntax :-)</p>

<h3 id="heredocs">Heredocs</h3>

<p>String heredocs are now more powerful and convenient: leading space is removed from heredoc lines according
to the leading space of the closing delimiter. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Same as "Hello\n  world"</span>
<span class="o">&lt;&lt;-</span><span class="no">STRING</span><span class="sh">
  Hello
    world
</span><span class="no">  STRING</span>

<span class="c1"># Same as "  Hello\n    world"</span>
<span class="o">&lt;&lt;-</span><span class="no">STRING</span><span class="sh">
    Hello
      world
</span><span class="no">  STRING</span></code></pre></figure>
</div>

<p>The old behaviour was inconvenient because it forced you to write all content aligned to the left. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Program</span>
  <span class="nc">USAGE</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="sh">
Usage: crystal [command] [switches] [program file] [--] [arguments]

Command:
    init                     generate a new project
    ...
</span><span class="no">USAGE</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Now you can write it like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Program</span>
  <span class="nc">USAGE</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="sh">
    Usage: crystal [command] [switches] [program file] [--] [arguments]

    Command:
        init                     generate a new project
        ...
</span><span class="no">    USAGE</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Thank you <a href="https://github.com/rhysd">rhysd</a> for suggesting this change.</p>

<h2 id="semantic-changes">Semantic changes</h2>

<p>Previously, <code class="highlighter-rouge">return</code> could be used inside a captured block. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span> <span class="p">:</span> <span class="o">-&gt;</span> <span class="no">Int32</span><span class="p">)</span>
  <span class="n">block</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">method</span>
  <span class="nb">proc</span> <span class="o">=</span> <span class="n">capture</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="k">return</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>A <code class="highlighter-rouge">return</code> usually returns from a method, bypassing the block, but in the case of a captured
block the <code class="highlighter-rouge">return</code> just exited the block and gave it a value. This was inconsistent, so now
you have to use <code class="highlighter-rouge">next</code>, which is the way you give a block it’s value in other situations. <code class="highlighter-rouge">return</code>
will give an error in this case.</p>

<h2 id="standard-library-changes">Standard library changes</h2>

<p>A huge refactor has been done to <code class="highlighter-rouge">HTTP::Server</code> to support streaming and upgrading protocols.</p>

<p>Previously you would write a server like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span>
  <span class="no">HTTP</span><span class="o">::</span><span class="no">Response</span><span class="p">.</span><span class="nf">ok</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">request</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">!"</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>The problem with this approach is that there’s no way to stream content to the response body. Well,
there was a way: you would set an IO as the response body, but this was awkward and complex.</p>

<p>Now the handler receives a context which includes a response object to which you can write to.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">print</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">context</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">!"</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Streaming data is now super easy:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">puts</span> <span class="n">i</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">flush</span>
    <span class="nb">sleep</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>The above code will write the numbers from 0 to 9, waiting 1 second between each write.</p>

<h2 id="performance-improvements">Performance improvements</h2>

<p>Before this release <code class="highlighter-rouge">libpcl</code> was used for fiber context switch. Now this is done with inline
assembly, which not only frees us from <code class="highlighter-rouge">libpcl</code>, it also works much faster.</p>

<p>Additionally, <code class="highlighter-rouge">URI.parse</code> was rewritten by <a href="https://github.com/will">will</a> to not use regular
expressions, which gave it a huge performance improvement.</p>

<h2 id="bug-fixes">Bug fixes</h2>

<p>The compiler’s code now does an initial pass to declare all classes, macros and methods. This
got rid of many bugs that depended on order of declaration, forcing you to use some ugly workarounds.</p>

<h2 id="shards-060">Shards 0.6.0</h2>

<p><a href="https://github.com/ysbaddaden">ysbaddaden</a>’s shards comes with two new commands: <code class="highlighter-rouge">prune</code> (removes extraneous libs)
and <code class="highlighter-rouge">init</code> (creates an initial shard.yml), as well as some bug fixes. Read the changelog
<a href="https://github.com/ysbaddaden/shards/releases/tag/v0.6.0">here</a>.</p>

<h2 id="thank-you">Thank you!</h2>

<p>We want to thank everyone that contributes, discusses, promotes and critizices this project. We
never stop being amazed at how much you do and help us grow the community, slowly getting us to <code class="highlighter-rouge">1.0</code>.</p>

<p>Happy crystaling!</p>

    </div>
    <div class="col m1"></div>
  </div>

  <div class="row disqus">
    <div class="col m2"></div>
    <div class="col s12 m9" id='disqus_thread'>
      <p><a href="https://github.com/crystal-lang/crystal/releases/tag/0.11.0">Crystal 0.11.0</a> has been released!</p>

<p>This release comes with syntax and semantic changes that favor consistency, standard library refactors,
many performance improvements and bug fixes. A new version of <a href="https://github.com/ysbaddaden/shards">shards</a>
is included.</p>

<p>Read the full changelog <a href="https://github.com/crystal-lang/crystal/releases/tag/0.11.0">here</a>.</p>

<h2 id="syntax-changes">Syntax changes</h2>

<h3 id="type-declarations-and-uninitialized-variables">Type declarations and uninitialized variables</h3>

<p>Before this release, <code class="highlighter-rouge">::</code> was used to declare the type of instance variables.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Point</span>
  <span class="vi">@x</span> <span class="o">::</span> <span class="no">Int32</span>
  <span class="vi">@y</span> <span class="o">::</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Additionally, <code class="highlighter-rouge">::</code> inside a method had the meaning of declaring a variable with uninitialized (unsafe) contents:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">method</span>
  <span class="c1"># Allocate stack memory, don't zero it</span>
  <span class="n">buffer</span> <span class="o">::</span> <span class="no">UInt8</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This was confusing, as a same syntax had two meanings. Now, the <code class="highlighter-rouge">::</code> syntax is gone. To declare the type
of a variable you use a single colon (<code class="highlighter-rouge">:</code>):</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Point</span>
  <span class="vi">@x</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="vi">@y</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>This is also consistent with the syntax of type restrictions:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="no">Int32</span><span class="p">)</span> <span class="p">:</span> <span class="no">Int32</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>To declare a variable with uninitialized content you now do:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">method</span>
  <span class="c1"># Allocate stack memory, don't zero it</span>
  <span class="n">buffer</span> <span class="o">=</span> <span class="n">uninitialized</span> <span class="no">UInt8</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>which is much more explicit and clear.</p>

<p>Additionally, type annotations are now allowed in class and global variables.</p>

<p>To upgrade your code to this new syntax, just run <code class="highlighter-rouge">crystal tool format</code> on your project: the formatter still
understand the old syntax and will modify your code to use the new syntax :-)</p>

<h3 id="heredocs">Heredocs</h3>

<p>String heredocs are now more powerful and convenient: leading space is removed from heredoc lines according
to the leading space of the closing delimiter. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Same as "Hello\n  world"</span>
<span class="o">&lt;&lt;-</span><span class="no">STRING</span><span class="sh">
  Hello
    world
</span><span class="no">  STRING</span>

<span class="c1"># Same as "  Hello\n    world"</span>
<span class="o">&lt;&lt;-</span><span class="no">STRING</span><span class="sh">
    Hello
      world
</span><span class="no">  STRING</span></code></pre></figure>
</div>

<p>The old behaviour was inconvenient because it forced you to write all content aligned to the left. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Program</span>
  <span class="nc">USAGE</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="sh">
Usage: crystal [command] [switches] [program file] [--] [arguments]

Command:
    init                     generate a new project
    ...
</span><span class="no">USAGE</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Now you can write it like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Program</span>
  <span class="nc">USAGE</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="sh">
    Usage: crystal [command] [switches] [program file] [--] [arguments]

    Command:
        init                     generate a new project
        ...
</span><span class="no">    USAGE</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Thank you <a href="https://github.com/rhysd">rhysd</a> for suggesting this change.</p>

<h2 id="semantic-changes">Semantic changes</h2>

<p>Previously, <code class="highlighter-rouge">return</code> could be used inside a captured block. For example:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span> <span class="p">:</span> <span class="o">-&gt;</span> <span class="no">Int32</span><span class="p">)</span>
  <span class="n">block</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">method</span>
  <span class="nb">proc</span> <span class="o">=</span> <span class="n">capture</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="k">return</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>A <code class="highlighter-rouge">return</code> usually returns from a method, bypassing the block, but in the case of a captured
block the <code class="highlighter-rouge">return</code> just exited the block and gave it a value. This was inconsistent, so now
you have to use <code class="highlighter-rouge">next</code>, which is the way you give a block it’s value in other situations. <code class="highlighter-rouge">return</code>
will give an error in this case.</p>

<h2 id="standard-library-changes">Standard library changes</h2>

<p>A huge refactor has been done to <code class="highlighter-rouge">HTTP::Server</code> to support streaming and upgrading protocols.</p>

<p>Previously you would write a server like this:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span>
  <span class="no">HTTP</span><span class="o">::</span><span class="no">Response</span><span class="p">.</span><span class="nf">ok</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">request</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">!"</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>The problem with this approach is that there’s no way to stream content to the response body. Well,
there was a way: you would set an IO as the response body, but this was awkward and complex.</p>

<p>Now the handler receives a context which includes a response object to which you can write to.</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">print</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">context</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">!"</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>Streaming data is now super easy:</p>

<div class="code_section">
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
  <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s2">"text/plain"</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">puts</span> <span class="n">i</span>
    <span class="n">context</span><span class="p">.</span><span class="nf">response</span><span class="p">.</span><span class="nf">flush</span>
    <span class="nb">sleep</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>
</div>

<p>The above code will write the numbers from 0 to 9, waiting 1 second between each write.</p>

<h2 id="performance-improvements">Performance improvements</h2>

<p>Before this release <code class="highlighter-rouge">libpcl</code> was used for fiber context switch. Now this is done with inline
assembly, which not only frees us from <code class="highlighter-rouge">libpcl</code>, it also works much faster.</p>

<p>Additionally, <code class="highlighter-rouge">URI.parse</code> was rewritten by <a href="https://github.com/will">will</a> to not use regular
expressions, which gave it a huge performance improvement.</p>

<h2 id="bug-fixes">Bug fixes</h2>

<p>The compiler’s code now does an initial pass to declare all classes, macros and methods. This
got rid of many bugs that depended on order of declaration, forcing you to use some ugly workarounds.</p>

<h2 id="shards-060">Shards 0.6.0</h2>

<p><a href="https://github.com/ysbaddaden">ysbaddaden</a>’s shards comes with two new commands: <code class="highlighter-rouge">prune</code> (removes extraneous libs)
and <code class="highlighter-rouge">init</code> (creates an initial shard.yml), as well as some bug fixes. Read the changelog
<a href="https://github.com/ysbaddaden/shards/releases/tag/v0.6.0">here</a>.</p>

<h2 id="thank-you">Thank you!</h2>

<p>We want to thank everyone that contributes, discusses, promotes and critizices this project. We
never stop being amazed at how much you do and help us grow the community, slowly getting us to <code class="highlighter-rouge">1.0</code>.</p>

<p>Happy crystaling!</p>

    </div>
    <div class="col m1"></div>
  </div>
</div>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'crystal-lang'; // required: replace example with your forum shortname
  var disqus_identifier = '/2016/01/23/crystal-0.11.0-released';
  var disqus_title = "Crystal 0.11.0 released!";
  var disqus_url = "http://crystal-lang.org//2016/01/23/crystal-0.11.0-released.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
  Please enable JavaScript to view the
  <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
  comments powered by
  <span class='logo-disqus'>Disqus</span>
</a>

      </main>
      <footer>
  <div class="row">
    <div class="col s12 m12 l6 crystal" style="margin-top: -.5em;">
      Crystal is licensed under the Apache License,
      <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>
        Version 2.0
      </a>
			<br />
			本站正體中文（臺灣）翻譯由 
			<a href='https://github.com/crystal-tw' target='_blank'>
				Crystal-TW
			</a>
			社群貢獻。
    </div>
    <div class="col s12 m12 l6 manas right-align black-text">
      Crystal language, born &amp; raised at
      <a href="https://manas.tech" target="_blank" class="black-text">Manas</a>
      <a href="https://manas.tech" target="_blank" class="logo">
        <i class="manas"></i>
      </a>
    </div>
  </div>
</footer>

    </div>

    <script id="dsq-count-scr" src="//crystal-lang.disqus.com/count.js" async></script>
    <script type="text/javascript" src="/assets/bundle.js"></script>
    <!-- Disable original GA temporary
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42353458-1', 'auto');
  ga('send', 'pageview');
</script>
-->

  </body>
</html>
